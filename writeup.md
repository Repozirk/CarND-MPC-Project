# Model Predictive Controller## BasicsThis is Project 5 of Udacity Self-Driving Car Nanodegree program and the last project of Term 2. The goal of the project is to drive a car in a simulator around the virtual track with a MPC using C++.By using waypoints from the track via telemetry, the MPC reacts with acceleration and steeering commands to keep the vehicle on the track. It is also necessary to deal with a latency of 100ms. The project was created with the Udacity [Starter Code](https://github.com/udacity/CarND-MPC-Project).## [Rubric](https://review.udacity.com/#!/rubrics/896/view) Points- **The Model**: Student describes their model in detail. This includes the state, actuators and update equations.The kinematic model includes the vehicles position x and y, the orientation angle psi, the velocity v and the cross-track error cte  and psi error epsi. The output of the MPC are the acceleration a and the steering angle delta. The update equations are shown below: ```     x_[t+1] = x[t] + v[t] * cos(psi[t]) * dt     y_[t+1] = y[t] + v[t] * sin(psi[t]) * dt     psi_[t+1] = psi[t] + v[t] / Lf * delta[t] * dt     v_[t+1] = v[t] + a[t] * dt     cte[t+1] = f(x[t]) - y[t] + v[t] * sin(epsi[t]) * dt     epsi[t+1] = psi[t] - psides[t] + v[t] * delta[t] / Lf * dt```- **Timestep Length and Elapsed Duration (N & dt)**: Student discusses the reasoning behind the chosen N (timestep length) and dt (elapsed duration between timesteps) values. Additionally the student details the previous values tried.The values of N an dt have been choosen with N=10 and dt=0.1. These values lead to a prediction time of 1 second. I tried to increase N, with the result of slowing down the simulator. Changing the dt-Value to smaller and higher number lead to very unstable controller behavior. With the choosen set of N and dt the vechicle was able to drive around the track up to a Speed of 100km/hThe values of N=10 and dt=0.1 have been suggested by the Q&A-Video. - **Polynomial Fitting and MPC Preprocessing**: A polynomial is fitted to waypoints. If the student preprocesses waypoints, the vehicle state, and/or actuators prior to the MPC procedure it is described.The coordinates of the waypoints have been transformed to the vehicle coordinate system. Based on this transformation the polynominal fitting to the waypoints was solved with a simplified approach (px, py and psi = 0).```     shift_x = ptsx[i] - px;     shift_y = ptsy[i] - py;     ptsx_trans[i] = (shift_x * cos(-psi)) - (shift_y * sin(-psi));     ptsy_trans[i] = (shift_x * sin(-psi)) + (shift_y * cos(-psi));```- **Model Predictive Control with Latency**: The student implements Model Predictive Control that handles a 100 millisecond latency. Student provides details on how they deal with latency.The latency describes following behavior: There is a 100ms delay between the actuator calculation of steering / acceleration output and the vehicle reaction (or the simulator reaction).To solve the problem of latency, the model reaction with a predict step of 100ms was calculated and the predicted values have been passed to the state-vector. This approach was discussed in the related Project Forums.With the benefits of the transformation of the waypoints to vehicle coordinate system (px, py and psi = 0), following equations describe the predicted values depending on latency:```     pred_px = 0.0 + v * 1.0 * latency;     pred_py = 0.0 + v * 0.0 * latency;;     pred_psi = 0.0 + v * -delta / Lf * latency     pred_v = v + a * latency;     pred_cte = cte + v * sin(epsi) * latency;     pred_epsi = epsi + v * -delta / Lf * latency;     state << pred_px, pred_py, pred_psi, pred_v, pred_cte, pred_epsi;```## ResultTuning the MPC cost function to smooth steering and acceleration reactions and the right values of N and dt lead to the desired vehicle behavior and a successfull lap around the track up to 100km/h without hitting the curb or other unsafe diving situations.